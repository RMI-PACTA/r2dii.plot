---
title: "r2dii.plot Y"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This article shows the "Y" API. It assumes you already read the [article
comparing the "X" and "Y"
APIs](https://2degreesinvesting.github.io/r2dii.plot/articles/articles/r2dii-plot-X-versus-Y.html).

```{r setup}
library(dplyr, warn.conflicts = FALSE)
library(ggplot2, warn.conflicts = FALSE)
library(r2dii.plot)
```

### Timeline

The timeline plot uses `sda`-like data. First prepare it with
`prep_timelineY()`, then plot it with `plot_timelineY()`.

Use `prep_timelineY()` to prepare the data. You'll need to subset the data to
meet the requirements of the `plot_timelineY()`, which you can do with the
argument `sector_filter`. If you forget, the error message should guide you.

```{r error = TRUE}
# Fails
prep_timelineY(sda)

# Works
cement <- prep_timelineY(sda, sector_filter = "cement")
# Same
cement <- prep_timelineY(filter(sda, sector == "cement"))

cement

# Default recoding
plot_timelineY(cement)
```

You can further polish your plot. Your options are limitless but these are
some typical things you may do:

* Pick a narrower time range (by filtering your data using `dplyr`).
* Extrapolate the timeline.
* Add a title. 

```{r}
cement <- prep_timelineY(
  filter(sda, sector == "cement", year >= 2020),
  extrapolate = TRUE
)

plot_timelineY(cement) +
  labs(title = "Timeline plot")
```

* `plot_timelineY()` defaults to recoding `line_name` to title case, and allows
custom recoding and colour setting via a data frame passed to the argument
`specs`.

```{r}

# Custom recoding
custom <- tribble(
                ~line_name,                  ~label,        ~hex,
               "projected",                 "Proj.",   "#4a5e54",
       "corporate_economy",         "Corp. Economy",   "#a63d57",
             "target_demo",         "Target (demo)",   "#78c4d6",
  "adjusted_scenario_demo",  "Adj. Scenario (demo)",   "#f2e06e",
)

plot_timelineY(cement, specs = custom)
```

### Techmix

The techmix plot uses `market_share`-like data. First prepare it with
`prep_techmixY()`, then plot it with `plot_techmixY()`. `prep_techmiY()`
includes a number of arguments that help you meet the `data` requirements of
`plot_techmixY()`.

```{r}
data <- prep_techmixY(
  market_share,
  sector_filter = "power",
  years_filter = c(2020, 2025),
  region_filter = "global",
  scenario_source_filter = "demo_2020",
  scenario_filter = "sds",
  value = "technology_share"
)

plot_techmixY(data) + labs(title = "Techmix plot")
```

You can also add a bunch of customizations (order and choice of bars to show,
custom labels, custom colours) using additional `plot_techmixY()` arguments.

```{r}
data <- prep_techmixY(
  market_share,
  sector_filter = "power",
  years_filter = c(2020, 2025),
  region_filter = "global",
  scenario_source_filter = "demo_2020",
  scenario_filter = "sds",
  value = "technology_share"
)

metric_type_order <- c("portfolio_2020", "benchmark_2020", "portfolio_2025", "benchmark_2025", "scenario_2025")
metric_type_label <- c("Port. 2020", "Bench. 2020", "Port. 2025", "Bench. 2025", "Scen. 2025")

tech_colors_custom <- data.frame(
  technology = c("coalcap", "oilcap", "gascap", "nuclearcap", "hydrocap", "renewablescap"),
  label = c("Coal Cap.", "Oil Cap.", "Gas Cap.", "Nuclear Cap.", "Hydro Cap.", "Renewables Cap."),
  hex = c("black", "brown", "grey", "red", "blue", "green4"),
  stringsAsFactors = FALSE
)
tech_colors_custom

plot_techmixY(
  data,
  metric_type_order = metric_type_order,
  metric_type_label = metric_type_label,
  tech_colours = tech_colors_custom
)
```

### Trajectory

The trajectory plot uses `market_share`-like data. First prepare it with
`prep_trajectoryY()`, then plot it with `plot_trajectoryY()`. As you may expect
by now, `prep_trajectoryY()` includes arguments to meet the `data` requirements
of `plot_trajectoryY()`. `plot_trajectoryY()` inputs a number of data frames
which require you to specify the order of scenarios and order of significance
for the trajectory lines.

```{r}
data <- prep_trajectoryY(
  market_share,
  sector_filter = "power",
  technology_filter = "renewablescap",
  region_filter = "global",
  scenario_source_filter = "demo_2020",
  value = "production"
)

scenario_specs <- data.frame(
  scenario = c("sds", "sps", "cps"),
  stringsAsFactors = FALSE
)

main_line_metric <- data.frame(metric = "projected", stringsAsFactors = FALSE)

additional_line_metrics <- data.frame(
  metric = "corporate_economy",
  stringsAsFactors = FALSE
)

plot_trajectoryY(
  data,
  scenario_specs_good_to_bad = scenario_specs,
  main_line_metric = main_line_metric,
  additional_line_metrics = additional_line_metrics
) + labs(title = "Trajectory plot")
```

Use `normalize = FALSE` if you prefer not to normalize to the start year.

```{r}
data <- prep_trajectoryY(
  market_share,
  sector_filter = "power",
  technology_filter = "renewablescap",
  region_filter = "global",
  scenario_source_filter = "demo_2020",
  value = "production",
  normalize = FALSE
)

plot_trajectoryY(
  data,
  scenario_specs_good_to_bad = scenario_specs,
  main_line_metric = main_line_metric,
  additional_line_metrics = additional_line_metrics
)
``` 

You can customize the labels in the plot by adding 'label' column to the input
data frames.

```{r}
data <- prep_trajectoryY(
  market_share,
  sector_filter = "power",
  technology_filter = "renewablescap",
  region_filter = "global",
  scenario_source_filter = "demo_2020",
  value = "production"
)

scenario_specs <- data.frame(
  scenario = c("sds", "sps", "cps"),
  label = c("SDS", "STEPS", "CPS"),
  stringsAsFactors = FALSE
)

main_line_metric <- data.frame(
  metric = "projected", 
  label = "Portfolio",
  stringsAsFactors = FALSE
)

additional_line_metrics <- data.frame(
  metric = "corporate_economy",
  label = "Corporate Economy",
  stringsAsFactors = FALSE
)

plot_trajectoryY(
  data,
  scenario_specs_good_to_bad = scenario_specs,
  main_line_metric = main_line_metric,
  additional_line_metrics = additional_line_metrics
) + labs(title = "Trajectory plot")
```

If you haven't done so already, please see the [article about the "X"
API](https://2degreesinvesting.github.io/r2dii.plot/articles/articles/r2dii-plot-X.html).
